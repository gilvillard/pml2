#include "nmod_extra.h"

/*------------------------------------------------------------------------*/
/*------------------------------------------------------------------------*/
/*              A few extra functionalities for Fp                        */
/*------------------------------------------------------------------------*/
/*------------------------------------------------------------------------*/

/*------------------------------------------------------------------------*/
/* returns the smallest i such that 2^i >= x                              */
/*------------------------------------------------------------------------*/
int next_power_of_two(mp_limb_t x)
{
    int i = 0, j = 1;
    while (j < (int) x)
    {
        i++;
        j <<= 1;
    }
    return i;
}

/*------------------------------------------------------------------------*/
/* returns 1/p mod 2^k, assuming p is odd                                 */
/* ill-defined when p is even                                             */
/*------------------------------------------------------------------------*/
mp_limb_t inverse_mod_power_of_two(mp_limb_t p, int k)
{
  mp_limb_t ip = 1L;
  mp_limb_t old;
  do
  {
      old = ip;
      ip = (2*ip-p*ip*ip);
  }
  while (ip != old);
  return ip & ((1L << k)-1);
}
